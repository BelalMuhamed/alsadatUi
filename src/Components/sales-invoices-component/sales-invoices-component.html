<div class="w-100 d-flex justify-content-center align-items-center">
  <h2 class="w-25 text-center">فواتير المبيعات</h2>
</div>
<div class="filter-form" dir="rtl">
  <mat-form-field appearance="outline" >
    <mat-label>اسم الموزع</mat-label>
    <input matInput [(ngModel)]="filters.distributorName" placeholder="أدخل اسم الموزع" />
  </mat-form-field>

  <mat-form-field appearance="outline">
    <mat-label>منشئ الفاتورة</mat-label>
    <input matInput [(ngModel)]="filters.craetedBy" placeholder="أدخل اسم المنشئ" />
  </mat-form-field>
<mat-form-field appearance="outline">
  <mat-label>حالة الفاتورة</mat-label>
  <mat-select [(ngModel)]="filters.salesInvoiceType">
   <mat-option value="" disabled selected>اختر الحالة</mat-option>
    <mat-option [value]="0">جديد</mat-option>
    <mat-option [value]="1">دفع جزئي</mat-option>
    <mat-option [value]="2">مدفوعة</mat-option>
    <mat-option [value]="3">مرتجع</mat-option>
  </mat-select>
</mat-form-field>

  <mat-form-field>
                <mat-label >Enter a date range</mat-label>
                <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                    <input matStartDate formControlName="start" placeholder="Start date">
                    <input matEndDate formControlName="end" placeholder="End date">
                </mat-date-range-input>
                <mat-hint>MM/DD/YYYY – MM/DD/YYYY</mat-hint>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>


</div>
<div class="container d-flex justify-content-center align-items-center">
  <button mat-raised-button color="primary" (click)="onFilter()" class="action-btn mx-4">بحث</button>
  <button mat-stroked-button color="warn" (click)="onReset()" class="action-btn">إعادة تعيين</button>
</div>

<hr style="border-color: var(--gold); opacity: 0.5; margin: 10px 0;">

  <div class="page-content">
@if (isLoading) {
    <p  class="text-center" style="color: var(--gold);">Loading...</p>
}
@else  {
  <div class="table-container mat-elevation-z8">
 <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" >

   @for (col of columns; track col.key) {
  <ng-container [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef> {{ col.label }} </th>
    <td mat-cell *matCellDef="let element">
      @switch (col.type) {
 @case ('date') {
  <span>{{ element[col.key] | date:'dd-MM-yyyy' }}</span>
}


        @case ('currency') {
          <span>{{ element[col.key] | currency:'EGP':'symbol' }}</span>
        }
        @case ('boolean') {
          @if (element[col.key]) {
            <mat-icon >check_circle</mat-icon>
          } @else {
            <mat-icon >cancel</mat-icon>
          }
        }
         @case ('number') {
      @if (col.key === 'salesInvoiceStatus') {
        <span>{{ getStatusText(element[col.key]) }}</span>
      } @else {
        <span>{{ element[col.key] }}</span>
      }
    }
     @case ('actions') {
    <div class="action-buttons">
      <button mat-icon-button color="primary" (click)="goToDetails(element)">
        <mat-icon>visibility</mat-icon>
      </button>

      <button mat-icon-button color="accent" >
        <mat-icon>edit</mat-icon>
      </button>
    </div>
  }
        @default {

            <span>{{ element[col.key] }}</span>

        }
      }
    </td>
  </ng-container>
}


    <tr mat-header-row *matHeaderRowDef="displayedColumnKeys"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnKeys"></tr>
  </table>
</div>
  <div dir="rtl" class="paginator-arabic">
  <mat-paginator
    [length]="totalCount"
    [pageSize]="filters.pageSize"
    [pageIndex]="filters.page - 1"
    [pageSizeOptions]="[5, 10, 20]"
    (page)="onPageChange($event)">
  </mat-paginator>
</div>

  <ng-template #loading>
    <div class="flex justify-center p-4">
      <mat-spinner></mat-spinner>
    </div>
  </ng-template>
}



</div>
