<div class="tree-accounts-container">
  <div class="tree-header">
    <h2>شجرة الحسابات</h2>
    <button mat-raised-button class="action-btn" (click)="onAdd()">
      <mat-icon>add</mat-icon>
      إضافة حساب رئيسي
    </button>
  </div>

  <div class="tree-content" *ngIf="!loading">
    <div class="tree-table-header">
      <div class="col-account">اسم الحساب</div>
      <div class="col-debit">مدين</div>
      <div class="col-credit">دائن</div>
      <div class="col-balance">الرصيد</div>
      <div class="col-actions">الإجراءات</div>
    </div>

    <div class="tree-rows">
      <div
        *ngFor="let account of flatAccounts"
        class="tree-row"
        [class.visible]="isVisible(account)"
        [class.has-children]="hasChildren(account)"
        [style.padding-right.px]="(account.level || 0) * 30 + 16">

        <div class="row-content">
          <!-- Expand/Collapse Button -->
          <div class="col-account">
            <button
              *ngIf="hasChildren(account)"
              class="expand-btn"
              (click)="toggleExpand(account)"
              [class.expanded]="account.expanded">
              <mat-icon>{{ account.expanded ? 'expand_more' : 'chevron_left' }}</mat-icon>
            </button>

            <span class="account-icon" [class.parent]="hasChildren(account)">
              <mat-icon>{{ hasChildren(account) ? 'folder' : 'description' }}</mat-icon>
            </span>

            <span class="account-name">{{ account.accountName }}</span>
          </div>

          <!-- Debit -->
          <div class="col-debit">
            {{ formatNumber(account.debit) }}
          </div>

          <!-- Credit -->
          <div class="col-credit">
            {{ formatNumber(account.credit) }}
          </div>

          <!-- Balance -->
          <div class="col-balance">
            <span [ngClass]="getBalanceClass(getBalance(account))">
             {{ formatNumber(abs(getBalance(account))) }}

            </span>
          </div>

          <!-- Actions -->
          <div class="col-actions">
            <button
              mat-icon-button
              class="action-icon-btn"
              matTooltip="عرض التفاصيل"
              (click)="onView(account)">
              <mat-icon>visibility</mat-icon>
            </button>

            <button
              mat-icon-button
              class="action-icon-btn"
              matTooltip="تعديل"
              (click)="onEdit(account)">
              <mat-icon>edit</mat-icon>
            </button>

            <button
              *ngIf="hasChildren(account)"
              mat-icon-button
              class="action-icon-btn add-child"
              matTooltip="إضافة حساب فرعي"
              (click)="onAdd(account)">
              <mat-icon>add_circle</mat-icon>
            </button>

            <button
              mat-icon-button
              class="action-icon-btn delete"
              matTooltip="حذف"
              (click)="onDelete(account)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading">
    <mat-icon class="spinner">refresh</mat-icon>
    <p>جاري تحميل شجرة الحسابات...</p>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && flatAccounts.length === 0">
    <mat-icon>account_tree</mat-icon>
    <h3>لا توجد حسابات</h3>
    <p>ابدأ بإضافة حساب رئيسي جديد</p>
    <button mat-raised-button class="action-btn" (click)="onAdd()">
      <mat-icon>add</mat-icon>
      إضافة حساب
    </button>
  </div>
</div>
